<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
  xmlns:html="http://www.w3.org/TR/REC-html40">
  <Styles>
    <Style ss:ID="s00">
      <Interior ss:Color="#CCCCCC" ss:Pattern="Solid"/>
    </Style>
    <Style ss:ID="s01">
      <Interior ss:Color="#FF6666" ss:Pattern="Solid"/>
    </Style>
  </Styles>
  <Worksheet ss:Name="Sheet1">
    <Table>
      <Row>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Day</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Date</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Email</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">User name</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Division</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Checkin Time</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Place Checkin</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Checkout Time</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Place Checkout</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Total hours</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Status</Data></Cell>
        <Cell ss:StyleID="s00"><Data ss:Type="String">Note</Data></Cell>
      </Row>
      <% date = Time.parse(params[:from]) %>
      <% while date <= Time.parse(params[:to]) %>
        <% @users.each do |user| %>
          <% presence = Presence.where("date = ? and user_id = ?",date.strftime("%Y-%m-%d"),user.id).first %>
          <% if !presence.nil? %>
            <% datetime = Time.parse(presence.date).advance(:minutes => -cookies["time_zone_offset"].to_i) %>
            <Row>
            <Cell><Data ss:Type="String"><%= datetime.strftime("%A") %></Data></Cell>
            <Cell><Data ss:Type="String"><%= datetime.strftime("%-d %B %Y") %></Data></Cell>
            <Cell><Data ss:Type="String"><%= user.email %></Data></Cell>
            <Cell><Data ss:Type="String"><%= user.name %></Data></Cell>
            <Cell><Data ss:Type="String"><%= user.division %></Data></Cell>
            </Row>
          <% end %>
        <% end %>
        <% date += 1.day %>
      <% end %>
    </Table>
  </Worksheet>
</Workbook>